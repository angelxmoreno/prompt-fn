"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[3762],{7205(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"guides/logging-and-recovery","title":"Logging & Recovery","description":"Resilient prompts need observability. prompt-fn layers structured logging, fallbacks, and manual content parsing so you can still ship when a provider emits malformed JSON.","source":"@site/docs/guides/logging-and-recovery.md","sourceDirName":"guides","slug":"/guides/logging-and-recovery","permalink":"/docs/guides/logging-and-recovery","draft":false,"unlisted":false,"editUrl":"https://github.com/angelxmoreno/prompt-fn/edit/main/docs-site/docs/guides/logging-and-recovery.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"logging-and-recovery","sidebar_position":2,"title":"Logging & Recovery"},"sidebar":"tutorialSidebar","previous":{"title":"Templates & Renderers","permalink":"/docs/guides/templates-and-renderers"},"next":{"title":"Examples","permalink":"/docs/category/examples"}}');var i=r(4848),t=r(8453);const s={id:"logging-and-recovery",sidebar_position:2,title:"Logging & Recovery"},l=void 0,c={},d=[{value:"pino logger",id:"pino-logger",level:2},{value:"Recovery flow",id:"recovery-flow",level:2},{value:"Tuning provider requests",id:"tuning-provider-requests",level:2}];function a(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Resilient prompts need observability. prompt-fn layers structured logging, fallbacks, and manual content parsing so you can still ship when a provider emits malformed JSON."}),"\n",(0,i.jsx)(n.h2,{id:"pino-logger",children:"pino logger"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import pino from 'pino';\n\nconst logger = pino({ name: 'Adder Prompt', level: 'debug' });\n\nconst addNumbers = definePrompt({\n  ...,\n  logger,\n});\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Each invocation logs ",(0,i.jsx)(n.code,{children:"module"}),", ",(0,i.jsx)(n.code,{children:"errorName"}),", and ",(0,i.jsx)(n.code,{children:"content"})," when something goes wrong."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"logger.child({ module: name })"})," if you need per-prompt context."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"recovery-flow",children:"Recovery flow"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["We call ",(0,i.jsx)(n.code,{children:"generateObject"})," / ",(0,i.jsx)(n.code,{children:"generateText"})," with ",(0,i.jsx)(n.code,{children:"outputSchema"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"generation.output"})," is missing, we inspect ",(0,i.jsx)(n.code,{children:"generation.content"})," and attempt to parse JSON ourselves."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"recoverFromContent"})," (see ",(0,i.jsx)(n.code,{children:"src/utils/outputRecovery.ts"}),") strips fences, trims whitespace, and re-validates."]}),"\n",(0,i.jsx)(n.li,{children:"If manual parsing works, we log a warning instead of an error and return the recovered payload."}),"\n",(0,i.jsx)(n.li,{children:"If everything fails, the original AI SDK error bubbles up, still enriched with logger metadata."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can override the recovery strategy by wrapping ",(0,i.jsx)(n.code,{children:"recoverFromContent"})," or by transforming ",(0,i.jsx)(n.code,{children:"generation.content"})," before calling ",(0,i.jsx)(n.code,{children:"outputSchema.parse"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"tuning-provider-requests",children:"Tuning provider requests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ollama OpenAI-compatible endpoints often wrap JSON in quotes. The built-in recovery handles this scenario automatically."}),"\n",(0,i.jsxs)(n.li,{children:["For providers that support ",(0,i.jsx)(n.strong,{children:"structured output mode"})," (e.g., Gemini 1.5, OpenAI Responses API), keep ",(0,i.jsx)(n.code,{children:"outputSchema"})," strict\u2014prompt-fn already passes the JSON schema to the provider."]}),"\n",(0,i.jsxs)(n.li,{children:["If you rely on ",(0,i.jsx)(n.code,{children:"generateText"}),", consider supplying a lightweight ",(0,i.jsx)(n.code,{children:"outputSchema"})," and falling back to ",(0,i.jsx)(n.code,{children:"recoverFromContent"})," for consistency."]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>l});var o=r(6540);const i={},t=o.createContext(i);function s(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);